<div class="result-panel child">
  <div class="result-panel-main-results">
    <md-card *ngIf="full_result">
      <md-card-header class="rapd-result">
        <div style="width:100%">
          <div style="float:left;">
            <h3>
              Indexing Results for
              <span>{{full_result.header1.basename}}</span>
              <span style="color:blue;"><md-icon (click)="displayHeader(full_result.header1)">info_outline</md-icon></span>
              <span *ngIf="full_result.header2"> & {{full_result.command.header2.basename}}</span>
              <span *ngIf="full_result.header2" style="color:blue;"><md-icon (click)="displayHeader(full_result.header2)">info_outline</md-icon></span>
            </h3>
          </div>
          <div class="rapd-select-panel">
            <md-select
              placeholder="View mode"
              floatPlaceholder="auto"
              (change)="onViewModeSelect(view_mode)"
              [(ngModel)]="view_mode"
              name="view_mode"
              value="summary">
              <md-option value="summary">Summary</md-option>
              <md-option value="analysis">Details</md-option>
              <md-option value="logs">Logs</md-option>
            </md-select>
          </div>
        </div>
      </md-card-header>
      <md-card-content *ngIf="view_mode === 'summary'" class="rapd-result">
        <div fxLayout="row" fxLayoutGap="10px">
          <div fxFlex fxLayout="column" fxLayoutGap="10px">
            <div fxFlex="none">
              <h3>Indexing Solution</h3>
              <table class="rapd-table">
                <thead>
                  <tr>
                    <th>Spacegroup</th>
                    <th>Unit Cell</th>
                    <th>Mosaicity</th>
                    <th>Resolution</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{this.full_result.results.labelit_results.best_sym}}</td>
                    <td>
                      {{this.full_result.results.labelit_results.best_cell[0]}} &Aring;,
                      {{this.full_result.results.labelit_results.best_cell[1]}} &Aring;,
                      {{this.full_result.results.labelit_results.best_cell[2]}} &Aring;,
                      {{this.full_result.results.labelit_results.best_cell[3]}}&deg;,
                      {{this.full_result.results.labelit_results.best_cell[4]}}&deg;,
                      {{this.full_result.results.labelit_results.best_cell[5]}}&deg;
                    </td>
                    <td>{{this.full_result.results.labelit_results.mosflm_mos[0]}}&deg;</td>
                    <td>{{this.full_result.results.labelit_results.mosflm_res[0]}} &Aring;</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div fxFlex>
              <h2>Data Collection Strategies</h2>
              <div>
                <h3>Normal</h3>
                <table class="rapd-table">
                  <thead>
                    <tr>
                      <th>N</th>
                      <th>&Omega; Start</th>
                      <th>&Delta;&Omega;</th>
                      <th># Images</th>
                      <th>Exposure time</th>
                      <th>Distance</th>
                      <th>Transmission</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let key of objectKeys(full_result.results.best_results_norm.sweeps)">
                      <td>{{full_result.results.best_results_norm.sweeps[key].run_number}}</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].phi_start}}&deg;</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].phi_width}}&deg;</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].number_of_images}}</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].exposure_time}}s</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].distance.toFixed(0)}}mm</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].transmission.toFixed(1)}}%</td>
                    </tr>
                  </tbody>
                </table>
                <button md-raised-button (click)="plotOmegaStart('norm')">Osc Range Plot</button>
                <button md-raised-button (click)="plotDeltaOmega('norm')">Osc Width Plot</button>
              </div>
              <div>
                <h3>Anomalous</h3>
                <table class="rapd-table">
                  <thead>
                    <tr>
                      <th>N</th>
                      <th>&Omega; Start</th>
                      <th>&Delta;&Omega;</th>
                      <th># Images</th>
                      <th>Exposure time</th>
                      <th>Distance</th>
                      <th>Transmission</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let key of objectKeys(full_result.results.best_results_anom.sweeps)">
                      <td>{{full_result.results.best_results_norm.sweeps[key].run_number}}</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].phi_start}}&deg;</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].phi_width}}&deg;</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].number_of_images}}</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].exposure_time}}s</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].distance.toFixed(0)}}mm</td>
                      <td>{{full_result.results.best_results_norm.sweeps[key].transmission.toFixed(1)}}%</td>
                    </tr>
                  </tbody>
                </table>
                <button md-raised-button (click)="plotOmegaStart('anom')">Osc Range Plot</button>
                <button md-raised-button (click)="plotDeltaOmega('anom')">Osc Width Plot</button>
              </div>
            </div>
          </div>
          <div fxFlex fxLayout="column" fxLayoutGap="10px" class="rapd-result">
            <div fxFlex="none" style="width:80%;">
              <div style="float:left;">
                <h3>{{selected_plot}}</h3>
              </div>
              <div style="float:right;">
                <md-select
                  placeholder="Select plot"
                  (change)="setPlot(selected_plot)"
                  [(ngModel)]="selected_plot"
                  name="plot">
                  <md-option *ngFor="let key of objectKeys(full_result.results.plots)" [value]="key">{{key}}</md-option>
                </md-select>
              </div>
            </div>
            <div fxFlex="grow">
              <div class="chart-container" style="position: relative;">
                <div *ngIf="selected_plot=='osc_range'">
                  <canvas baseChart
                    [datasets]="data.ys"
                    [labels]="data.xs"
                    [options]="data.lineChartOptions"
                    [chartType]="data.lineChartType"
                    [colors]="lineChartColors"
                    (chartHover)="chartHovered($event)"
                    (chartClick)="chartClicked($event)">
                  </canvas>
                </div>
                <div *ngIf="selected_plot=='osc_range_anom'">
                  <canvas baseChart
                    [datasets]="data.ys"
                    [labels]="data.xs"
                    [options]="data.lineChartOptions"
                    [chartType]="data.lineChartType"
                    [colors]="lineChartColors"
                    (chartHover)="chartHovered($event)"
                    (chartClick)="chartClicked($event)">
                  </canvas>
                </div>
                <div *ngIf="selected_plot=='max_delta_omega'">
                  <canvas baseChart
                    [datasets]="data.ys"
                    [labels]="data.xs"
                    [options]="data.lineChartOptions"
                    [chartType]="data.lineChartType"
                    [colors]="lineChartColors"
                    (chartHover)="chartHovered($event)"
                    (chartClick)="chartClicked($event)">
                  </canvas>
                </div>
                <div *ngIf="selected_plot=='wilson'">
                  <canvas baseChart
                    [datasets]="data.ys"
                    [labels]="data.xs"
                    [options]="data.lineChartOptions"
                    [chartType]="data.lineChartType"
                    [colors]="lineChartColors"
                    (chartHover)="chartHovered($event)"
                    (chartClick)="chartClicked($event)">
                  </canvas>
                </div>
                <div *ngIf="selected_plot=='rad_damage'">
                  <canvas baseChart
                    [datasets]="data.ys"
                    [labels]="data.xs"
                    [options]="data.lineChartOptions"
                    [chartType]="data.lineChartType"
                    [colors]="lineChartColors"
                    (chartHover)="chartHovered($event)"
                    (chartClick)="chartClicked($event)">
                  </canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </md-card-content>
    </md-card>
  </div>
  <md-toolbar *ngIf="full_result" class="result-panel-action-bar">
    <h2 style="margin-right:1em;">Actions</h2>
    <button md-raised-button (click)="openReindexDialog()">Reindex</button>
    <button md-raised-button (click)="printPage()">Print</button>
  </md-toolbar>
</div>
